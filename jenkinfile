pipeline {
  agent any

  stages {
    stage('Compiling and Running Test Cases') {
      steps {
        sh 'mvn clean'
        sh 'mvn compile'
        sh 'mvn test'
      }
    }

    stage('Generating Cucumber Reports') {
      steps {
        script {
          // Run Cucumber tests and generate reports
          sh 'mvn verify'
        }
      }
    }

    stage('Creating Package') {
      steps {
        sh 'mvn package'
      }
    }
  }

  post {
    always {
      cucumber generateReport: true,
               jsonReportDirectory: 'target/cucumber-reports',
               fileIncludePattern: '**/*.json',
               parallelTesting: false
    }
  }
}
